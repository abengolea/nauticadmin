rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Videoteca: solo coach y responsable de escuela (school_admin) pueden subir/ver videos
    // Cualquier ruta bajo schools/{schoolId}/players/{playerId}/ (incl. videos/xxx)
    match /schools/{schoolId}/players/{playerId}/{allPaths=**} {
      allow read, write: if request.auth != null
        && firestore.exists(/databases/(default)/documents/schools/$(schoolId)/users/$(request.auth.uid))
        && firestore.get(/databases/(default)/documents/schools/$(schoolId)/users/$(request.auth.uid)).data.get('role', '') in ['school_admin', 'coach'];
    }
  }
}
